# Developers information

## Pre-requisites

--> brew install jq

You don't need to have specific NPM package to work with the Rainbow-CLI

But you need to add the following environment variables for accessing to Mailjet

$ export MJ_APIKEY_PUBLIC=<Mailjet_PUBLIC_KEY>
$ export MJ_APIKEY_PRIVATE=<Mailjet_PRIVATE_KEY>

## Development

---

Development could be done in any IDE like Studio Code.

### Continuous development

---

Execute the following command to launch the server for continuous integration:

```bash

$ npm start

```

This will ask Brunch to start a local web server and to restart the page on each modification

In addition, ESLint report is build on each modification.

### Continous integration

---

Execute the following command to launch no regression testing during development

```bash

$ npm run test:watch

```

If you want to check the current coverage, launch the following command:

```bash

$ npm run test:coverage

```

## Production

---

Several tasks have to be launched in order to publish a new version of the Rainbow Hub

-   Update version and changelog

-   Publish for pre-integration test (.net) + email

-   Generate and send newsletter

### Preparation

---

#### Update version

---

Version has to be changed in file `package.json`.

Property `version` need to be updated.

TODO: Create brunch task for updating version in file (/config/version.js) from package.json - or directly update the file Footer.jsx

#### Update Changelog (internal)

---

Update file `CHANGELOG.md` according to the list of tickets fixed in that release.

This changelog is not published.

#### Update What's new (for developers)

---

No `what's new` section today on the Rainbow API Hub.

### Production

---

#### Jenkins pre-production build

---

Open Jenkins and produce the following projects:

-   [Rainbow API HUB task](https://jenkins.openrainbow.org/job/OTLite-developer-hub-Release/) and click on "Launch a build with parameter", enter the version number and launch the build.

-   [Rainbow CLI doc task](https://jenkins.openrainbow.org/view/CPaaS%20-%20Release/job/CPaas-Node-CLI-Doc-Release/) and click on "Launch a build with parameter", enter the version number and launch the build.

-   [Rainbow Web doc task](https://jenkins.openrainbow.org/view/CPaaS%20-%20Release/job/CPaas-Web-SDK-Doc-Release//) and click on "Launch a build with parameter", enter the version number and launch the build.

-   [Rainbow IOS doc task](https://jenkins.openrainbow.org/view/CPaaS%20-%20Release/job/CPaas-iOS-SDK-Doc-Release/) and click on "Launch a build with parameter", enter the version number and launch the build.

-   Android is build after Android SDK production

-   Others projects (ie: Node...) are normally automatically produced when source code is pushed to gitlab. Please verify you got the right packages

-   API Docs are generated by Server Team production

Check that the build has been correctly done.

#### NOC

---

Go to [NOC](https://noc.openrainbow.org/#/dashboard)

Select location **RDEU**.

Click on **Packages** and select Source = **Strech** and Group = **Hub**.

Check that **otlitedeveloperhub** has the correct version in **strech-nightly**. Click on **resync** button if not.

Push these components to **stretch-testing** (by clicking on the arrow) if not automatically set.

#### Pre-production update

Go to [NOC](https://noc.openrainbow.org/#/dashboard)

Select menu **Preproduction** in the right bar and then click on button **Deployment Templates**.

Enter `Web` in the filter. Select the **Rainbow Web** component and click on the **Play** button

#### Notify when delivering on Preproduction

---

An email should be sent to Rainbow-deliveries mailing-list in order to inform of the delivery of this component.

Open a shell and lauch the following commands:

```bash

$ cd mailing
$ node mailChangelog.js notify

```

File `changelog.yaml` contains the parameters that can be configured.

### Packages publication

---

The following packages need to be published on npm:

| Name                         | Description                                                  | Command                              |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------------ |
| rainbow-cli                  | Rainbow CLI application based on the Rainbow SDK for Node.js | from project directory `npm publish` |
| rainbow-node-sdk             | Alcatel-Lucent Enterprise Rainbow SDK for Node.js            | from project directory `npm publish` |
| rainbow-web-sdk              | Alcatel-Lucent Enterprise Rainbow SDK for Web                | from build directory `npm publish`   |
| node-red-contrib-ale-rainbow | Alcatel-Lucent Enterprise Rainbow Nodes for Node Red         | from project directory `npm publish` |

#### Github release note

---

Publish only master and branch release directory, don't forget to push tags too.

Go on Github, and in the release section, edit a new release note and add the content of the changelog.

#### Notify when delivering on production

---

Rainbow deliveries needs to be informed of the delivery on production.

Open a sheel and launch the following commands:

```bash

$ cd mailing
$ node mailChangelog.js notify -e "production"

```
